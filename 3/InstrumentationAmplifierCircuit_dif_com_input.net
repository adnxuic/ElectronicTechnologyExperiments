* G:\LTspiceFile\ElectronicTechnologyExperiments\3\InstrumentationAmplifierCircuit_dif_com_input.asc
* Generated by LTspice 24.1.9 for Windows.
V1 +V 0 15
V2 -V 0 -15
X§U1 Vi1 N002 +V -V VA1 AD712
X§U2 Vi2 N004 +V -V VA2 AD712
X§U3 N003 N001 +V -V Vo AD712
R1 N002 N004 {RG}
R2 N001 VA1 1k
R3 N003 VA2 1k
R4 VA1 N002 10k
R5 VA2 N004 10k
R6 Vo N001 1k
R7 0 N003 1k
V3 Vi1 0 {Vic + Vid/2}
V4 Vi2 0 {Vic - Vid/2}
.step param RG list 0.2k 1k 2k 10k 20k
* --- 定义分析类型：对 "mode" 进行DC扫描 ---
* mode=0: 共模测试 (Vic=0.1V, Vid=0V)
* mode=1: 差模测试 (Vic=0V, Vid=0.2V)
* mode=2: 失调测试 (Vic=0V, Vid=0V)
.dc param mode 0 2 1
* --- 根据 "mode" 的值定义 Vid 和 Vic ---
* 差模测试(mode=1): Vid=0.2V (使 V3=+0.1V, V4=-0.1V)
* 共模测试(mode=0): Vic=0.1V (使 V3=+0.1V, V4=+0.1V)
.param Vic = if(mode==0, 0.1, 0)
.param Vid = if(mode==1, 0.2, 0)
* --- 测量指令 ---
* 1. 在DC扫描中找到每种模式对应的原始输出电压
.meas dc V_out_comm FIND V(vo) AT 0
.meas dc V_out_diff FIND V(vo) AT 1
.meas dc V_out_offset FIND V(vo) AT 2
* 2. 计算所需的物理量
* Vo (报告差模和共模下的Vo)
.meas dc Vo_differential_Output PARAM V_out_diff
.meas dc Vo_common_mode_Output PARAM V_out_comm
* Ad (差模增益 = Vo / Vid, 其中 Vid = 0.2V)
.meas dc Ad_Gain PARAM V_out_diff / 0.2
* Ac (共模增益 = (Vo_comm - Vo_offset) / Vic, 其中 Vic = 0.1V)
.meas dc Ac_Gain PARAM (V_out_comm - V_out_offset) / 0.1
* CMRR (共模抑制比)
.meas dc CMRR_Ratio PARAM abs(Ad_Gain / Ac_Gain)
.meas dc CMRR_dB PARAM 20*log10(abs(Ad_Gain / Ac_Gain))
.lib ADI1.lib
.backanno
.end
